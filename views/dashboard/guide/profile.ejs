<!-- Guide Profile Info -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Info | Bambuddy</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <!-- Bootstrap Icon -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />

    <!-- Google Font -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap"
    />

    <!-- CSS Global Variable -->
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/theme.css" />

    <!-- CSS Style For Guide/User -->
    <link rel="stylesheet" href="/css/user.css" />
    <script src="/js/theme-loader.js"></script>
  </head>
  <body class="<%= user?.theme || 'light' %>">
    <%- include('../../partials/navbar') %>

    <div class="container-fluid p-3 p-md-5">
      <main
        id="main-content"
        class="user-page-container row"
        role="main"
        aria-label="Guide Profile Edit Page"
      >
        <aside
          class="user-sidebar-navigation col-12 col-md-3 px-0 pe-md-3 mb-4 mb-md-0"
          role="navigation"
          aria-label="Dashboard navigation"
        >
          <ul class="nav flex-column row-gap-2 p-2" role="menubar">
            <li
              class="nav-item d-flex justify-content-start align-items-center"
              role="none"
            >
              <a
                class="nav-link flex-fill"
                href="/guide/dashboard"
                role="menuitem"
                aria-label="Overview"
                tabindex="0"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-kanban me-2"
                  viewBox="0 0 16 16"
                  aria-hidden="true"
                >
                  <path
                    d="M13.5 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm-11-1a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"
                  />
                  <path
                    d="M6.5 3a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1zm-4 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1zm8 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1z"
                  /></svg
                ><span>Overview</span></a
              >
            </li>
            <li
              class="nav-item d-flex justify-content-start align-items-center"
              role="none"
            >
              <a
                class="nav-link active flex-fill"
                aria-current="page"
                href="/guide/profile"
                role="menuitem"
                aria-label="My Profile - Current page"
                tabindex="0"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-person-circle me-2"
                  viewBox="0 0 16 16"
                  aria-hidden="true"
                >
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                  <path
                    fill-rule="evenodd"
                    d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"
                  /></svg
                ><span>My Profile</span></a
              >
            </li>
            <li
              class="nav-item d-flex justify-content-start align-items-center"
              role="none"
            >
              <a
                class="nav-link flex-fill"
                href="/guide/booking"
                role="menuitem"
                aria-label="Booking Management"
                tabindex="0"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-list-ul me-2"
                  viewBox="0 0 16 16"
                  aria-hidden="true"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"
                  /></svg
                ><span>Booking Management</span></a
              >
            </li>
            <li
              class="nav-item d-flex justify-content-start align-items-center"
              role="none"
            >
              <a
                class="nav-link flex-fill"
                aria-current="page"
                href="/guide/settings"
                role="menuitem"
                aria-label="Settings"
                tabindex="0"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-gear-wide-connected me-2"
                  viewBox="0 0 16 16"
                  aria-hidden="true"
                >
                  <path
                    d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5m0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78zM5.048 3.967l-.087.065zm-.431.355A4.98 4.98 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8zm.344 7.646.087.065z"
                  /></svg
                ><span>Settings</span></a
              >
            </li>
          </ul>
        </aside>

        <div
          class="edit-profile-container col-md-9 col-12 px-xl-4 px-3"
          role="main"
          aria-label="Profile edit form"
        >
          <h1 id="profile-heading">Edit Profile</h1>
          <div class="container">
            <div class="row border-bottom">
              <form
                action="/guide/profile"
                method="post"
                enctype="multipart/form-data"
                aria-labelledby="profile-heading"
                novalidate
              >
                <div class="row">
                  <div class="col-12 col-xl-6 ps-md-0 p-0 m-0">
                    <div
                      class="basicInformation-container p-3 p-md-4 my-3 my-md-4"
                      role="group"
                      aria-labelledby="basic-info-heading"
                    >
                      <h5 id="basic-info-heading" class="mb-0">
                        Basic Information
                      </h5>
                      <div class="row">
                        <div class="col-12 col-md-6">
                          <label for="firstName" class="form-label"
                            >First Name</label
                          >
                          <input
                            type="text"
                            id="firstName"
                            name="firstName"
                            class="form-control"
                            value="<%= profile?.profileInfo?.firstName || '' %>"
                            placeholder="Enter your first name"
                            required
                            aria-describedby="firstName-help"
                          />
                          <div id="firstName-help" class="visually-hidden">
                            Enter your first name
                          </div>
                        </div>
                        <div class="col-12 col-md-6">
                          <label for="lastName" class="form-label"
                            >Last Name</label
                          >
                          <input
                            type="text"
                            id="lastName"
                            name="lastName"
                            value="<%= profile?.profileInfo?.lastName || '' %>"
                            class="form-control"
                            placeholder="Enter your last name"
                            required
                            aria-describedby="lastName-help"
                          />
                          <div id="lastName-help" class="visually-hidden">
                            Enter your last name
                          </div>
                        </div>
                      </div>

                      <label for="city" class="form-label">City</label>
                      <input
                        type="text"
                        id="city"
                        name="city"
                        class="form-control"
                        value="<%= profile?.profileInfo?.city || '' %>"
                        placeholder="Enter your city"
                        aria-describedby="city-help"
                      />
                      <div id="city-help" class="visually-hidden">
                        Enter the city where you are based
                      </div>
                      <label for="professionalTitle" class="form-label"
                        >Professional Title</label
                      >
                      <input
                        type="text"
                        id="professionalTitle"
                        name="professionalTitle"
                        value="<%= profile?.guideInfo?.professionalTitle || '' %>"
                        class="form-control"
                        placeholder="e.g. Professional Tour Guide, Cultural Expert"
                        aria-describedby="title-help"
                      />
                      <div id="title-help" class="visually-hidden">
                        Enter your professional title or expertise
                      </div>
                      <label for="bio" class="form-label">Bio</label>
                      <textarea
                        name="bio"
                        id="bio"
                        class="form-control"
                        rows="6"
                        placeholder="Tell visitors about yourself, your experience, and what makes you a great guide"
                        aria-describedby="bio-help"
                      >
 <%= profile?.profileInfo?.bio || '' %></textarea
                      >
                      <div id="bio-help" class="visually-hidden">
                        Write a brief description about yourself and your
                        guiding experience
                      </div>
                      <label for="facebook" class="form-label">Facebook</label>
                      <input
                        type="url"
                        id="facebook"
                        name="facebook"
                        value="<%= profile?.profileInfo?.facebook || '' %>"
                        class="form-control"
                        placeholder="https://facebook.com/yourprofile"
                        aria-describedby="facebook-help"
                      />
                      <div id="facebook-help" class="visually-hidden">
                        Enter your Facebook profile URL (optional)
                      </div>
                      <label for="instagram" class="form-label"
                        >Instagram</label
                      >
                      <input
                        type="url"
                        id="instagram"
                        name="instagram"
                        value="<%= profile?.profileInfo?.instagram || '' %>"
                        class="form-control"
                        placeholder="https://instagram.com/yourprofile"
                        aria-describedby="instagram-help"
                      />
                      <div id="instagram-help" class="visually-hidden">
                        Enter your Instagram profile URL (optional)
                      </div>
                    </div>
                  </div>

                  <div class="col-12 col-xl-6">
                    <div
                      class="profilePhoto-container row p-3 p-xl-4 my-xl-4 ms-xl-3 d-flex justify-content-center align-items-center"
                      role="group"
                      aria-labelledby="photo-heading"
                    >
                      <h5 id="photo-heading" class="mb-0 ps-0">
                        Profile Photo
                      </h5>
                      <img
                        src="<%= (user && user.profilePicture)
                          ? (user.profilePicture.startsWith('http')
                              ? user.profilePicture
                              : ('/uploads/profilePicture/' + user.profilePicture))
                          : '/img/defaultAvatar.png' %>"
                        class="profile-picture p-0 m-3"
                        alt="<%= profile?.profileInfo?.firstName || 'User' %>'s profile picture"
                        id="profilePicturePreview"
                      />
                      <input
                        type="file"
                        id="profilePhoto"
                        name="profilePhoto"
                        class="visually-hidden"
                        accept="image/png, image/jpeg"
                        aria-describedby="photo-requirements"
                      />

                      <div class="d-flex flex-column align-items-center">
                        <button
                          type="button"
                          id="changePhotoBtn"
                          class="btn btn-outline-primary"
                          onclick="changeProfilePhoto()"
                          aria-describedby="photo-requirements"
                        >
                          Change Photo
                        </button>
                        <small id="photo-requirements" class="m-2"
                          >Recommended: 400x400px, Max 2MB</small
                        >
                        <div
                          id="profilePhotoError"
                          class="invalid-feedback d-block"
                          style="display: none"
                        ></div>
                      </div>
                    </div>

                    <div
                      class="languagesAndSpeciliazations-container row p-xl-4 my-xl-4 ms-xl-3 my-3 p-3"
                      role="group"
                      aria-labelledby="lang-spec-heading"
                    >
                      <h5 id="lang-spec-heading" class="ps-0">
                        Languages and Specializations
                      </h5>
                      <div
                        class="form-check ps-0"
                        role="group"
                        aria-labelledby="languages-heading"
                      >
                        <div
                          id="languages-heading"
                          class="languages-title my-1"
                        >
                          Languages Spoken
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="vietnamese"
                          name="languages" class="form-check-input"
                          value="Vietnamese" <%= (profile?.guideInfo?.languages
                          || []).includes('Vietnamese') ? 'checked' : '' %> />
                          <label for="vietnamese" class="form-check-label"
                            >Vietnamese (Native)</label
                          >
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="english" name="languages"
                          class="form-check-input" value="Vietnamese" <%=
                          (profile?.guideInfo?.languages ||
                          []).includes('English') ? 'checked' : '' %> />
                          <label for="english" class="form-check-label"
                            >English (Fluent)</label
                          >
                        </div>
                      </div>

                      <div
                        class="form-check ps-0"
                        role="group"
                        aria-labelledby="specializations-heading"
                      >
                        <div
                          id="specializations-heading"
                          class="tour-specializations-title my-1"
                        >
                          Tour Specializations
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="foodAndCulinaryTours"
                          name="specializations" value="Food & Culinary Tours"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Food & Culinary Tours') ? 'checked' : ''
                          %> />
                          <label
                            class="form-check-label"
                            for="foodAndCulinaryTours"
                            >Food & Culinary Tours</label
                          >
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="historicalTours"
                          name="specializations" value="Historical Tours"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Historical Tours') ? 'checked' : '' %>
                          />
                          <label class="form-check-label" for="historicalTours"
                            >Historical Tours</label
                          >
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="shoppingTours"
                          name="specializations" value="Shopping Tours"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Shopping Tours') ? 'checked' : '' %> />
                          <label class="form-check-label" for="shoppingTours"
                            >Shopping Tours</label
                          >
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="culturalExperiences"
                          name="specializations" value="Cultural Experiences"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Cultural Experiences') ? 'checked' : ''
                          %> />
                          <label
                            class="form-check-label"
                            for="culturalExperiences"
                            >Cultural Experiences</label
                          >
                        </div>
                        <div class="form-check">
                          <input type="checkbox" id="photographyTours"
                          name="specializations" value="Photography Tours"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Photography Tours') ? 'checked' : '' %>
                          />
                          <label class="form-check-label" for="photographyTours"
                            >Photography Tours</label
                          >
                        </div>

                        <div class="form-check">
                          <input type="checkbox" id="nightLife"
                          name="specializations" value="Night Life"
                          class="form-check-input" <%=
                          (profile?.guideInfo?.specializations ||
                          []).includes('Night Life') ? 'checked' : '' %> />
                          <label class="form-check-label" for="nightLife"
                            >Night Life</label
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <button
                    type="submit"
                    class="btn-primary py-2"
                    aria-describedby="save-help"
                  >
                    Save Changes
                  </button>
                  <div id="save-help" class="visually-hidden">
                    Save all profile changes
                  </div>
                </div>
              </form>
            </div>
          </div>

          <form
            action="/guide/profile/certification"
            method="POST"
            enctype="multipart/form-data"
            aria-labelledby="certification-heading"
          >
            <div
              class="container-fluid certification-container my-4 p-4"
              role="group"
              aria-labelledby="certification-heading"
            >
              <div class="row">
                <div class="col">
                  <h5 id="certification-heading" class="ps-0">Certification</h5>
                  <div class="certificate-title col my-4 p-3">
                    <div class="row">
                      <div class="col">
                        Tourism License <span id="certUploadHelpEl"></span>
                      </div>
                      <div class="col text-end">
                        <% const hasVerifiedCert = certification &&
                        certification.some(cert => cert.isVerified); %> <% if
                        (hasVerifiedCert) { %>
                        <span id="certVerified" class="fw-semibold text-success"
                          >Verified</span
                        >
                        <% } else { %>
                        <span
                          id="certNotVerified"
                          class="fw-semibold text-danger"
                          >Not Verified</span
                        >
                        <% } %>
                      </div>
                    </div>
                  </div>
                  <% if (!hasVerifiedCert) { %>
                  <input
                    type="file"
                    name="certification"
                    accept=".pdf,.jpg,.png"
                    style="display: none"
                    id="certificateInput"
                    aria-describedby="cert-requirements"
                  />
                  <div id="cert-requirements" class="visually-hidden">
                    Upload PDF, JPG, or PNG format. Tourism license
                    certification required.
                  </div>
                  <button
                    type="button"
                    id="changeCertificationBtn"
                    class="btn btn-outline-primary"
                    onclick="document.getElementById('certificateInput').click()"
                    aria-describedby="cert-requirements"
                  >
                    + Add Certification
                  </button>
                  <button
                    type="submit"
                    class="btn btn-primary ms-2"
                    style="display: none"
                    id="uploadBtn"
                    aria-label="Upload certification file"
                  >
                    Upload
                  </button>
                  <% } %>

                  <!-- Certification History Section -->
                  <div class="certification-history-section my-4">
                    <h5 class="mb-3">Certification History</h5>

                    <% if (certification && certification.length > 0) { %>
                    <div class="certificate-timeline">
                      <% certification.forEach((cert, index) => { %>
                      <div
                        class="certificate-item mb-4 p-3 border rounded <%= cert.isVerified ? 'border-success' : (cert.rejection && cert.rejection.reason ? 'border-danger' : 'border-warning') %>"
                      >
                        <div class="row align-items-center">
                          <div class="col">
                            <div class="d-flex align-items-center mb-2">
                              <div class="certificate-status me-3">
                                <% if (cert.isVerified) { %>
                                <span class="badge bg-success fs-6"
                                  >Verified</span
                                >
                                <% } else if (cert.rejection &&
                                cert.rejection.reason) { %>
                                <span class="badge bg-danger fs-6"
                                  >Rejected</span
                                >
                                <% } else { %>
                                <span class="badge bg-warning text-dark fs-6"
                                  >Pending</span
                                >
                                <% } %>
                              </div>
                              <div class="certificate-info">
                                <h6 class="mb-1">
                                  Tourism License Certificate #<%= index + 1 %>
                                </h6>
                                <small class="text-muted">
                                  Uploaded: <%= new
                                  Date(cert.createdAt).toLocaleDateString('en-US',
                                  { year: 'numeric', month: 'short', day:
                                  'numeric' }) %>
                                </small>
                              </div>
                            </div>

                            <% if (cert.isVerified && cert.verifiedAt) { %>
                            <div class="verification-details">
                              <small class="text-success">
                                Verified on <%= new
                                Date(cert.verifiedAt).toLocaleDateString('en-US',
                                { year: 'numeric', month: 'short', day:
                                'numeric' }) %>
                              </small>
                            </div>
                            <% } %> <% if (cert.rejection &&
                            cert.rejection.reason) { %>
                            <div class="rejection-details mt-2">
                              <small class="text-danger">
                                Rejected on <%= new
                                Date(cert.rejection.at).toLocaleDateString('en-US',
                                { year: 'numeric', month: 'short', day:
                                'numeric' }) %>
                              </small>
                              <div
                                class="rejection-reason mt-1 p-2 bg-danger-subtle border border-danger-subtle rounded"
                              >
                                <small
                                  ><strong>Reason:</strong> <%=
                                  cert.rejection.reason %></small
                                >
                              </div>
                            </div>
                            <% } %>
                          </div>
                        </div>
                      </div>
                      <% }) %>
                    </div>
                    <% } else { %>
                    <div class="no-certificates text-center py-4">
                      <div class="text-muted">
                        <i
                          class="bi bi-file-earmark-text fs-1 d-block mb-3"
                        ></i>
                        <h6>No certificates uploaded yet</h6>
                        <p>
                          Upload your tourism license certificate to get
                          verified as a tour guide.
                        </p>
                      </div>
                    </div>
                    <% } %>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </main>
    </div>

    <%- include('../../partials/footer') %>

    <script src="/js/user.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
    <script></script>
  </body>
</html>
